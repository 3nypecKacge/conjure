#!/usr/bin/env sh

# Only compile if there's a commit newer than the current classes directory.
# This prevents every vim-plug update from compiling when nothing changed.
# If you _need_ to have everything recompiled, just delete classes.
if [ ! -d classes ] || [ $(git show -s --format=%ct HEAD) -gt $(stat -c %Y classes) ]; then
  echo "[1/2] Compiling Conjure"
  rm -rf classes
  mkdir classes
  clojure -Sforce -A:compile --eval "(compile 'conjure.main)"

  echo "[2/2] Preparing dependencies for runtime injection"
  clojure -Sforce -A:tools --main conjure.munge.main

  echo "Everything's ready! Let's perform some magic."
fi
